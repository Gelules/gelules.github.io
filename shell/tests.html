<!DOCTYPE HTML>
<html lang="fr" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Tests et conditions - Pédiluve</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Pédiluve</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="tests-et-conditions"><a class="header" href="#tests-et-conditions">Tests et conditions</a></h1>
<p>Tu sais récupérer les variables envoyées en paramètres à ton script, tu sais en
créer, tu sais faire un peu de maths et afficher toutes ces variables. C'est
bien. Mais que dirais-tu de rendre tes scripts un peu plus vivants ? D'avoir des
exécutions différentes selon ce que tu envoies en paramètres ? C'est déjà plus
intéressant.</p>
<h2 id="conditions"><a class="header" href="#conditions">Conditions</a></h2>
<p>Une condition en shell est un test qui va renvoyer Vrai ou Faux. Si c'est Vrai,
alors le script va emprunter un chemin d'exécution, si c'est Faux, alors le
script va emprunter un autre chemin d'exécution.</p>
<h1 id="test"><a class="header" href="#test">Test</a></h1>
<p>Tu peux tester plusieurs choses en shell : les nombres, les chaînes de
caractères, l'existence de fichier, les exécutions d'autres programmes.</p>
<p>Je t'invite à lire le <strong>man 1 test</strong> qui liste tous les tests possibles.</p>
<p>Comme tu peux le vois, on peut combiner les tests avec les portes logiques
<strong>AND</strong> et <strong>OR</strong>.</p>
<p>Par exemple pour tester une chaîne de caractères, tu utilises le test</p>
<pre><code class="language-sh">[ chaine1 = chaine2 ]
</code></pre>
<p>Ce test renverra Faux.</p>
<p>Attention à bien laisser des ESPACES ' ' entre le signe '$' et à côté des
crochets '[' et ']'. Si tu ne laisses pas d'espaces, le shell ne comprendra pas
que c'est un test et boguera.</p>
<h3 id="protection"><a class="header" href="#protection">Protection</a></h3>
<p>Avant de montrer des exemples, je dois te montrer une technique de protection
des scripts pour éviter des crashs embêtants.</p>
<pre><code class="language-sh">#!/bin/sh

mot_de_passe=$1

if [ $mot_de_passe = "pediluve" ]
then
    echo "Ouverture de la porte secrète"
else
    echo "Mauvais mot de passe"
fi
</code></pre>
<p>Exécute ce script sans lui envoyer de paramètre.</p>
<pre><code class="language-text">$ ./script.sh
./script.sh: line 5: [: =: unary operator expected
Mauvais mot de passe
$
</code></pre>
<p>Que s'est-il passé ?</p>
<p>La variable n'a pas de valeur, le shell a donc lu la ligne avec le test
littéralement de cette manière :</p>
<pre><code class="language-sh">if [ = "pediluve" ]
</code></pre>
<p>Ceci n'est pas du shell valide. Il faut une valeur avant le signe '='.</p>
<p>Tu peux protéger ta variable en lui mettant des double quotes.</p>
<pre><code class="language-sh">#!/bin/sh

mot_de_passe=$1

if [ "$mot_de_passe" = "pediluve" ]
then
    echo "Ouverture de la porte secrète"
else
    echo "Mauvais mot de passe"
fi
</code></pre>
<p>Si tu exécutes le script sans paramètre, voici ce que le shell lit.</p>
<pre><code class="language-sh">if [ "" = "pediluve" ]
</code></pre>
<p>Le shell comprend alors qu'il teste une chaîne de caractères vide avec
"pediluve".</p>
<h2 id="exemples"><a class="header" href="#exemples">Exemples</a></h2>
<h3 id="if-elif-else"><a class="header" href="#if-elif-else">if elif else</a></h3>
<p>Avant de te montrer de réels exemples, tu vas apprendre à enchainer les tests.</p>
<p><strong>if</strong> sert à tester une ou plusieurs conditions. Si tout est <strong>Vrai</strong>, alors le
code qui suit sera exécuté.</p>
<p><strong>elif</strong> est la concaténation de <strong>else if</strong>. Il faut aussi mettre une
condition, et si la condition est <strong>Vraie</strong>, alors le code qui suit sera
exécuté. Tu peux enchainer autant de <strong>elif</strong> que tu veux. Tu n'es pas obligé
d'utiliser <strong>elif</strong> quand tu fais des tests.</p>
<p><strong>else</strong> contient du code qui sera exécuté si tous les tests précédents étaient
<strong>Faux</strong>. Il ne faut pas lui mettre de test.</p>
<pre><code class="language-sh">#!/bin/sh

# Si le code secret n'est pas bon
# on écrit sur stderr que le code est faux
# et on quitte le script avec l'exit status 1
if [ "$1" != "super_mot_de_passe" ]
then
    echo "Mauvais mot de passe" &gt;&amp;2
    exit 1
fi

if [ "$2" = "gelules" ]
then
    echo "Bonjour maitre"
elif [ "$2" = "pediluvien" ]
then
    echo "Bonjour jeune apprenti"
elif [ "$2" = "piscinien" ]
then
    echo "Bonjour, tu viens te rafraichir la mémoire ?"
else
    echo "Tu m'es inconnu"
fi
</code></pre>
<h3 id="petit-jeu-vidéo"><a class="header" href="#petit-jeu-vidéo">Petit jeu vidéo</a></h3>
<p>Pour apprendre à faire des tests, au lieu de t'énumérer tous les tests
possibles, je préfère te montrer plein d'exemples différents. A toi ensuite de
lire le <strong>man 1 test</strong> pour compléter tes connaissances.</p>
<p>Imaginons que tu codes un petit jeu vidéo en shell.</p>
<pre><code class="language-sh">#!/bin/sh

# Si le nombre d'arguments n'est pas 2
if [ $# -ne 2 ]
then
    echo "Usage: $0 LOGIN SALLE_DE_TP" &gt;&amp;2
    exit 1
fi

login=$1
tp=$2
save_file=sauvegarde.txt

# Si le fichier de sauvegarde n'existe pas et que c'est bien un pédiluvien qui
# joue au jeu, on crée le fichier de sauvegarde
if [ ! -f "$save_file" ] -a [ "$login" != "gelules" ]
then
    touch "$save_file"
fi

# Exception pour le maitre de jeu
if [ "$login" = "gelules" ]
then
    echo "TP gelules dans 'salle secrète'" &gt;&gt; "gelules_sauvegarde.txt"
    exit
fi

if [ "$tp" = "donjon" ]
then
    echo "TP $login dans 'donjon'" &gt;&gt; "$save_file"
    exit
elif [ "$tp" = "tour" ]
then
    echo "TP $login dans 'tour'" &gt;&gt; "$save_file"
    exit
elif [ "$tp" = "chambre" ]
then
    echo "TP $login dans 'chambre'" &gt;&gt; "$save_file"
    exit
else
    echo "Mauvaise TP" &gt;&amp;2
    exit 1
fi
</code></pre>
<p>Je te laisse essayer le script.</p>
<p>Il n'est pas optimisé du tout. Comme tu peux le voir, il y a du code qui se
répète. On retrouve beaucoup de fois</p>
<pre><code class="language-sh">echo "TP $login dans 'LIEU'" &gt;&gt; "$save_file"
</code></pre>
<p>mais c'est un problème pour plus tard. Pour l'instant il faut que tu apprennes à
jouer avec les tests.</p>
<p>Je t'invite à regarder plus en détail comment tester les nombres. Dans mon
exemple je teste si le nombre d'argument est <strong>N</strong>ot <strong>E</strong>qual à 2. Mais tu peux
tester une égalité, si le nombre est strictement inférieur ou inférieur ou égal,
et pareil avec la supériorité.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../shell/quotting.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../shell/loops.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../shell/quotting.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../shell/loops.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
